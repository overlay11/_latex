% Предупреждать об устаревших командах
\RequirePackage[l2tabu,orthodox]{nag}

% Класс документа и опции
\providecommand\documentcls{extarticle}
\providecommand\documentmode{final}
\documentclass[twoside,onecolumn,\documentmode,12pt]{\documentcls}

% Размер страницы и поля
\usepackage[a4paper]{geometry}
\geometry{left=25mm,right=15mm}
\geometry{top=15mm,bottom=20mm}

% Типографская решетка
\usepackage[columns=1]{typogrid}

% Математика
\usepackage{amsmath,amsfonts,amssymb,amsthm}

% Локализация и шрифты
\usepackage{ifxetex}
\ifxetex
    \usepackage{polyglossia}
    \setdefaultlanguage{russian}
    \setotherlanguage{english}

    % Шрифты STIX 2 и Paratype
    % https://www.stixfonts.org/
    % https://www.paratype.ru/
    \setmainfont{STIX Two Text}[Ligatures=TeX]
    \setsansfont{PT Sans}
    \setmonofont{PT Mono}[Scale=MatchLowercase]
    \usepackage{unicode-math}
    \setmathfont{STIX Two Math}

    \usepackage{xunicode}
    \usepackage{xltxtra}
\else
    \usepackage[utf8]{inputenc}
    \usepackage[english,russian]{babel}
\fi

% Колонтитулы
\usepackage{fancyhdr}
\fancyhead{}
\fancyfoot[LO,RE,C]{}
\fancyfoot[RO,LE]{\thepage}
\renewcommand\headrulewidth{0pt}
\pagestyle{fancy}
\fancypagestyle{plain}{}

% Первый абзац с красной строки
\usepackage{indentfirst}

% Залезание строк на поля и висящие строки
\usepackage{ifdraft}
\ifdraft{\fussy}{
    \sloppy
    \usepackage[all]{nowidow}
}

% Микротипографические улучшения текста
\usepackage{microtype}

% Форматирование заголовков
\usepackage[medium,center,compact]{titlesec}
% Точка после номера в заголовке
\AtBeginDocument{\titlelabel{\thetitle. }}

% Расстояния между абзацами
\usepackage{nccparskip}

% Точки после номеров в содержании
\usepackage[dotinlabels]{titletoc}

% Точка в подписях рисунков и таблиц
\usepackage[labelsep=period]{caption}

% Состав содержания
\usepackage[nottoc,notindex]{tocbibind}

% Предметный указатель
\usepackage{imakeidx}
\makeindex[intoc]

% Рисунки
\usepackage{graphicx,tikz}
\graphicspath{{./}{figures/}}

% Альбомная ориентация рисунков и таблиц
\usepackage{pdflscape}

% Тонкая настройка таблиц
\usepackage{booktabs}

% Многостраничные таблицы
\usepackage{longtable}

% Гиперссылки, допускающие перенос
\usepackage{xurl}
\urlstyle{same}

% Гиперссылки и PDF-оглавление
\usepackage[numbered]{bookmark}
\hypersetup{hidelinks}

% Команды для ненумеруемых разделов, включаемых в содержание (имеют хаки
% для корректной работы hyperref совместно с titlesec)
\newcommand{\uchapter}[1]{
    \chapter*{#1}
    \addcontentsline{toc}{chapter}{#1}
}
\newcommand\sectionbreak{}
\newcommand{\usection}[1]{
    \renewcommand\sectionbreak\phantomsection
    \section*{#1}
    \addcontentsline{toc}{section}{#1}
    \renewcommand\sectionbreak{}
}
\newcommand\subsectionbreak{}
\newcommand{\usubsection}[1]{
    \renewcommand\subsectionbreak\phantomsection
    \subsection*{#1}
    \addcontentsline{toc}{subsection}{#1}
    \renewcommand\subsectionbreak{}
}

% Команда вставки рисунка
\newcommand\includefigure[3][]{
    \begin{figure}[htp]
        \centering
        \InputIfFileExists{#3}{}{
            \InputIfFileExists{figures/#3}{}{
                \includegraphics[#1]{#3}
            }
        }
        \caption{#2}
        \label{fig:#3}
    \end{figure}
}

% Команда вставки таблицы
\newcommand\includetable[2]{
    \begin{table}[htp]
        \caption{#1}
        \label{tab:#2}
        \InputIfFileExists{#2}{}{\input{tables/#2}}
    \end{table}
}

% Стиль списка литературы
\bibliographystyle{unsrt}

% Теоремоподобные окружения
\theoremstyle{definition}
    \newtheorem{definition}{Определение}[section]
    \newtheorem{axiom}{Аксиома}[section]
    \newtheorem{example}{Пример}[section]
    \newtheorem{exercise}{Упражнение}[section]
\theoremstyle{plain}
    \newtheorem{theorem}{Теорема}[section]
    \newtheorem{proposition}[theorem]{Утверждение}
    \newtheorem{metatheorem}{Метатеорема}[section]
    \newtheorem{lemma}{Лемма}[section]
\theoremstyle{remark}
    \newtheorem*{remark}{Замечание}

% Совместимость с pandoc
\newcommand\tightlist{\setlength\itemsep{0pt}\setlength\parskip{0pt}}

% Команды объявления названия и автора документа
\newcommand\settitle[1]{
    \title{#1}
    \hypersetup{pdftitle={#1}}
}
\newcommand\setauthor[1]{
    \author{#1}
    \hypersetup{pdfauthor={#1}}
}

% Дата выпуска документа
\date{\today}
